<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NH BOX - Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --deep-black: #0a0a0a;
            --dark-black: #141414;
            --medium-black: #1f1f1f;
            --light-black: #2a2a2a;
            --deep-red: #b20710;
            --bright-red: #e50914;
            --light-red: #ff3d3d;
            --white: #ffffff;
            --gray: #808080;
            --light-gray: #b3b3b3;
            --green: #00c853;
        }

        html, body {
            background: var(--deep-black);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 6px 10px;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            z-index: 9999;
        }

        .connection-status.connected {
            background: linear-gradient(90deg, #00c853, #00e676);
            color: #000;
        }

        .connection-status.disconnected {
            background: linear-gradient(90deg, var(--deep-red), var(--bright-red));
            color: #fff;
        }

        /* Header */
        .header {
            position: fixed;
            top: 26px;
            left: 0;
            right: 0;
            height: 54px;
            background: var(--dark-black);
            border-bottom: 1px solid var(--light-black);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-toggle {
            width: 40px;
            height: 40px;
            background: var(--medium-black);
            border: 1px solid var(--light-black);
            border-radius: 10px;
            color: var(--white);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-logo {
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(45deg, var(--bright-red), var(--light-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            font-size: 10px;
            color: var(--gray);
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1500;
            display: none;
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: var(--dark-black);
            border-right: 1px solid var(--light-black);
            z-index: 2000;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px 15px;
            border-bottom: 1px solid var(--light-black);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, var(--bright-red), var(--light-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-close {
            width: 36px;
            height: 36px;
            background: var(--medium-black);
            border: none;
            border-radius: 50%;
            color: var(--white);
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-menu {
            padding: 15px 0;
        }

        .menu-group {
            margin-bottom: 10px;
        }

        .menu-group-title {
            padding: 8px 20px;
            font-size: 10px;
            text-transform: uppercase;
            color: var(--gray);
            letter-spacing: 1px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--light-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        .menu-item:hover {
            background: rgba(229, 9, 20, 0.1);
            color: var(--white);
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(229, 9, 20, 0.2), transparent);
            color: var(--white);
            border-left-color: var(--bright-red);
        }

        .menu-item i {
            width: 22px;
            text-align: center;
            color: var(--bright-red);
            font-size: 15px;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 15px;
            padding-bottom: 40px;
            min-height: calc(100vh - 80px);
        }

        /* Page Header */
        .page-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--deep-red);
        }

        .page-title {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title i {
            color: var(--bright-red);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(145deg, var(--medium-black), var(--dark-black));
            padding: 18px;
            border-radius: 12px;
            border: 1px solid var(--light-black);
            text-align: center;
        }

        .stat-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--deep-red), var(--bright-red));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 18px;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 11px;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Section */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Card */
        .card {
            background: var(--medium-black);
            border-radius: 12px;
            border: 1px solid var(--light-black);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .card-header {
            padding: 14px 16px;
            background: linear-gradient(90deg, var(--deep-red), var(--medium-black));
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title {
            font-size: 14px;
            font-weight: bold;
        }

        .card-body {
            padding: 16px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            color: var(--light-gray);
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            background: var(--dark-black);
            border: 1px solid var(--light-black);
            border-radius: 8px;
            color: var(--white);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--bright-red);
            box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.2);
        }

        .form-input::placeholder {
            color: var(--gray);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23e50914' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            padding-right: 40px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--deep-red), var(--bright-red));
            color: var(--white);
        }

        .btn-primary:hover {
            box-shadow: 0 5px 20px rgba(229, 9, 20, 0.4);
        }

        .btn-secondary {
            background: var(--light-black);
            color: var(--white);
        }

        .btn-success {
            background: linear-gradient(90deg, #00c853, #00e676);
            color: #000;
        }

        .btn-danger {
            background: linear-gradient(90deg, #d32f2f, #f44336);
            color: var(--white);
        }

        .btn-warning {
            background: linear-gradient(90deg, #f57c00, #ff9800);
            color: #000;
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: 11px;
        }

        .btn-block {
            width: 100%;
        }

        /* Fetch Section */
        .fetch-row {
            display: flex;
            gap: 10px;
        }

        .fetch-row .form-input {
            flex: 1;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .category-card {
            background: var(--dark-black);
            border: 2px solid var(--light-black);
            border-radius: 12px;
            padding: 18px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-card:hover {
            border-color: var(--deep-red);
        }

        .category-card.selected {
            border-color: var(--bright-red);
            background: linear-gradient(145deg, rgba(229, 9, 20, 0.15), var(--dark-black));
        }

        .category-card i.category-icon {
            font-size: 28px;
            color: var(--bright-red);
            margin-bottom: 10px;
            display: block;
        }

        .category-card-name {
            font-size: 12px;
            font-weight: 600;
        }

        .category-card-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: var(--deep-red);
            border: none;
            border-radius: 50%;
            color: var(--white);
            font-size: 10px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .category-card:hover .category-card-delete {
            display: flex;
        }

        /* Add Category */
        .add-category-row {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .add-category-row .form-input {
            flex: 1;
        }

        /* Icon Picker */
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: var(--dark-black);
            border-radius: 10px;
        }

        .icon-option {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--medium-black);
            border: 2px solid var(--light-black);
            border-radius: 10px;
            cursor: pointer;
            color: var(--light-gray);
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .icon-option:hover {
            border-color: var(--deep-red);
            color: var(--white);
        }

        .icon-option.selected {
            border-color: var(--bright-red);
            background: var(--deep-red);
            color: var(--white);
        }

        /* Preview */
        .preview-row {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .preview-poster {
            width: 90px;
            height: 135px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--light-black);
            background: var(--dark-black);
        }

        .preview-backdrop {
            flex: 1;
            height: 135px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--light-black);
            background: var(--dark-black);
        }

        /* Cast Grid */
        .cast-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            max-height: 220px;
            overflow-y: auto;
            padding: 12px;
            background: var(--dark-black);
            border-radius: 10px;
        }

        .cast-item {
            text-align: center;
        }

        .cast-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--deep-red);
            margin: 0 auto 6px;
            display: block;
        }

        .cast-name {
            font-size: 9px;
            color: var(--light-gray);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Session Card */
        .session-card {
            background: var(--dark-black);
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--light-black);
            overflow: hidden;
        }

        .session-header {
            padding: 14px 16px;
            background: linear-gradient(90deg, var(--deep-red), var(--dark-black));
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .session-title-input {
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 14px;
            font-weight: bold;
            flex: 1;
            outline: none;
            margin-right: 12px;
        }

        .session-header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .session-body {
            padding: 14px;
            display: none;
        }

        .session-body.show {
            display: block;
        }

        .episode-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            align-items: center;
        }

        .episode-number {
            background: var(--deep-red);
            color: var(--white);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            min-width: 45px;
            text-align: center;
        }

        .episode-row .form-input {
            flex: 1;
            padding: 10px 12px;
        }

        .add-session-btn {
            width: 100%;
            padding: 16px;
            background: var(--dark-black);
            border: 2px dashed var(--deep-red);
            border-radius: 12px;
            color: var(--bright-red);
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 12px;
        }

        .add-session-btn:hover {
            background: var(--deep-red);
            color: var(--white);
            border-style: solid;
        }

        /* Data List */
        .data-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .data-item {
            background: var(--dark-black);
            border-radius: 12px;
            padding: 14px;
            display: flex;
            gap: 14px;
            align-items: flex-start;
            border: 1px solid var(--light-black);
            transition: border-color 0.3s ease;
        }

        .data-item:hover {
            border-color: var(--deep-red);
        }

        .data-poster {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
            background: var(--medium-black);
        }

        .data-info {
            flex: 1;
            min-width: 0;
        }

        .data-title {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .data-meta {
            font-size: 11px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .data-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .data-tag {
            padding: 4px 10px;
            background: var(--deep-red);
            border-radius: 12px;
            font-size: 9px;
            font-weight: 600;
        }

        .data-tag.secondary {
            background: var(--light-black);
        }

        .data-actions {
            display: flex;
            gap: 8px;
        }

        /* Filter Row */
        .filter-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
            padding-bottom: 10px;
            overflow-x: auto;
        }

        .filter-btn {
            padding: 10px 16px;
            background: var(--dark-black);
            border: 1px solid var(--light-black);
            border-radius: 25px;
            color: var(--light-gray);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .filter-btn.active {
            background: var(--deep-red);
            border-color: var(--bright-red);
            color: var(--white);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.92);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            padding: 15px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--dark-black);
            border-radius: 16px;
            width: 100%;
            max-width: 450px;
            max-height: 85vh;
            overflow: hidden;
            border: 1px solid var(--deep-red);
        }

        .modal-header {
            padding: 16px;
            background: linear-gradient(90deg, var(--deep-red), var(--medium-black));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 16px;
            max-height: 55vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px;
            border-top: 1px solid var(--light-black);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid var(--light-black);
            border-top-color: var(--bright-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 16px;
            color: var(--bright-red);
            font-size: 14px;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 25px;
            left: 15px;
            right: 15px;
            z-index: 9999;
        }

        .toast {
            background: var(--medium-black);
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid var(--bright-red);
            animation: toastIn 0.3s ease;
            font-size: 13px;
        }

        .toast.success {
            border-left-color: var(--green);
        }

        .toast.error {
            border-left-color: #f44336;
        }

        @keyframes toastIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 50px;
            color: var(--light-black);
            margin-bottom: 15px;
            display: block;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* Recent List */
        .recent-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recent-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px;
            background: var(--dark-black);
            border-radius: 10px;
        }

        .recent-item img {
            width: 45px;
            height: 68px;
            object-fit: cover;
            border-radius: 6px;
            background: var(--medium-black);
        }

        .recent-item-info {
            flex: 1;
            min-width: 0;
        }

        .recent-item-title {
            font-size: 14px;
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .recent-item-meta {
            font-size: 11px;
            color: var(--gray);
            margin-top: 3px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--deep-red);
            border-radius: 3px;
        }

        /* Refresh Button */
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--deep-red);
            border: none;
            border-radius: 50%;
            color: var(--white);
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Connection Status -->
    <div class="connection-status disconnected" id="connectionStatus">
        <i class="fas fa-circle"></i> Checking Firebase...
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div>
                <div class="header-logo">NH BOX</div>
                <div class="header-subtitle">Admin Panel</div>
            </div>
        </div>
    </header>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-film"></i> NH BOX
            </div>
            <button class="sidebar-close" onclick="toggleSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="sidebar-menu">
            <div class="menu-group">
                <div class="menu-group-title">Main</div>
                <div class="menu-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
            </div>
            <div class="menu-group">
                <div class="menu-group-title">Categories</div>
                <div class="menu-item" onclick="showSection('categories')">
                    <i class="fas fa-folder-plus"></i>
                    <span>Manage Categories</span>
                </div>
            </div>
            <div class="menu-group">
                <div class="menu-group-title">Web Series</div>
                <div class="menu-item" onclick="showSection('addWebseries')">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Web Series</span>
                </div>
                <div class="menu-item" onclick="showSection('editWebseries')">
                    <i class="fas fa-edit"></i>
                    <span>Edit Web Series</span>
                </div>
            </div>
            <div class="menu-group">
                <div class="menu-group-title">Movies</div>
                <div class="menu-item" onclick="showSection('addMovie')">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Movie</span>
                </div>
                <div class="menu-item" onclick="showSection('editMovie')">
                    <i class="fas fa-edit"></i>
                    <span>Edit Movies</span>
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Dashboard Section -->
        <section class="section active" id="dashboardSection">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </h1>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-tv"></i></div>
                    <div class="stat-number" id="statWebseries">0</div>
                    <div class="stat-label">Web Series</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-film"></i></div>
                    <div class="stat-number" id="statMovies">0</div>
                    <div class="stat-label">Movies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-folder"></i></div>
                    <div class="stat-number" id="statCategories">0</div>
                    <div class="stat-label">Categories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">Total Content</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-clock"></i>
                    <span class="card-title">Recent Activity</span>
                </div>
                <div class="card-body">
                    <div id="recentActivity">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No recent activity</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="section" id="categoriesSection">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-folder-plus"></i>
                    Manage Categories
                </h1>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-plus"></i>
                    <span class="card-title">Create Category</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Category Name</label>
                        <div class="add-category-row">
                            <input type="text" class="form-input" id="newCategoryName" placeholder="Enter category name">
                            <button class="btn btn-primary" onclick="createCategory()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Icon</label>
                        <div class="icon-picker" id="iconPicker"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-list"></i>
                    <span class="card-title">All Categories</span>
                </div>
                <div class="card-body">
                    <div class="category-grid" id="categoriesList"></div>
                </div>
            </div>
        </section>

        <!-- Add Web Series Section -->
        <section class="section" id="addWebseriesSection">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-plus-circle"></i>
                    Add Web Series
                </h1>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-download"></i>
                    <span class="card-title">Fetch from TMDB</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">TMDB TV Series ID</label>
                        <div class="fetch-row">
                            <input type="text" class="form-input" id="tmdbWebseriesId" placeholder="Enter TMDB ID (e.g., 1396)">
                            <button class="btn btn-primary" onclick="fetchWebseriesFromTMDB()">
                                <i class="fas fa-download"></i> Fetch
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-folder"></i>
                    <span class="card-title">Select Category *</span>
                </div>
                <div class="card-body">
                    <div class="category-grid" id="webseriesCategoryGrid"></div>
                    <input type="hidden" id="webseriesCategory">
                </div>
            </div>

            <form id="webseriesForm" onsubmit="saveWebseries(event)">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-info-circle"></i>
                        <span class="card-title">Basic Information</span>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Title *</label>
                            <input type="text" class="form-input" id="webseriesTitle" required placeholder="Enter title">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <input type="text" class="form-input" id="webseriesYear" placeholder="2024">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rating</label>
                                <input type="text" class="form-input" id="webseriesRating" placeholder="8.5">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select class="form-input form-select" id="webseriesLanguage">
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Tamil">Tamil</option>
                                <option value="Telugu">Telugu</option>
                                <option value="Malayalam">Malayalam</option>
                                <option value="Kannada">Kannada</option>
                                <option value="Korean">Korean</option>
                                <option value="Japanese">Japanese</option>
                                <option value="Spanish">Spanish</option>
                                <option value="French">French</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Poster URL</label>
                            <input type="url" class="form-input" id="webseriesPoster" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Backdrop URL</label>
                            <input type="url" class="form-input" id="webseriesBackdrop" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Storyline</label>
                            <textarea class="form-input form-textarea" id="webseriesStoryline" placeholder="Enter storyline..."></textarea>
                        </div>
                        <div class="preview-row">
                            <img src="https://via.placeholder.com/90x135?text=Poster" class="preview-poster" id="webseriesPosterPreview">
                            <img src="https://via.placeholder.com/200x135?text=Backdrop" class="preview-backdrop" id="webseriesBackdropPreview">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-users"></i>
                        <span class="card-title">Cast</span>
                    </div>
                    <div class="card-body">
                        <div class="cast-grid" id="webseriesCastGrid">
                            <div class="empty-state" style="grid-column: span 4;">
                                <i class="fas fa-users"></i>
                                <p>Fetch from TMDB to load cast</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list-ol"></i>
                        <span class="card-title">Sessions & Episodes</span>
                    </div>
                    <div class="card-body">
                        <div id="sessionsContainer"></div>
                        <button type="button" class="add-session-btn" onclick="addSession()">
                            <i class="fas fa-plus"></i> Add Session
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn btn-success btn-block">
                    <i class="fas fa-save"></i> Save Web Series
                </button>
            </form>
        </section>

        <!-- Edit Web Series Section -->
        <section class="section" id="editWebseriesSection">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-edit"></i>
                    Edit Web Series
                </h1>
            </div>

            <div class="filter-row" id="webseriesFilterRow">
                <button class="filter-btn active" onclick="filterWebseries('all', this)">All</button>
            </div>

            <div class="data-list" id="webseriesList">
                <div class="empty-state">
                    <i class="fas fa-tv"></i>
                    <p>Loading web series...</p>
                </div>
            </div>
        </section>

        <!-- Add Movie Section -->
        <section class="section" id="addMovieSection">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-plus-circle"></i>
                    Add Movie
                </h1>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-download"></i>
                    <span class="card-title">Fetch from TMDB</span>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">TMDB Movie ID</label>
                        <div class="fetch-row">
                            <input type="text" class="form-input" id="tmdbMovieId" placeholder="Enter TMDB ID (e.g., 550)">
                            <button class="btn btn-primary" onclick="fetchMovieFromTMDB()">
                                <i class="fas fa-download"></i> Fetch
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-folder"></i>
                    <span class="card-title">Select Category *</span>
                </div>
                <div class="card-body">
                    <div class="category-grid" id="movieCategoryGrid"></div>
                    <input type="hidden" id="movieCategory">
                </div>
            </div>

            <form id="movieForm" onsubmit="saveMovie(event)">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-info-circle"></i>
                        <span class="card-title">Basic Information</span>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Title *</label>
                            <input type="text" class="form-input" id="movieTitle" required placeholder="Enter title">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Year</label>
                                <input type="text" class="form-input" id="movieYear" placeholder="2024">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rating</label>
                                <input type="text" class="form-input" id="movieRating" placeholder="8.5">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Language</label>
                            <select class="form-input form-select" id="movieLanguage">
                                <option value="English">English</option>
                                <option value="Hindi">Hindi</option>
                                <option value="Tamil">Tamil</option>
                                <option value="Telugu">Telugu</option>
                                <option value="Malayalam">Malayalam</option>
                                <option value="Kannada">Kannada</option>
                                <option value="Korean">Korean</option>
                                <option value="Japanese">Japanese</option>
                                <option value="Spanish">Spanish</option>
                                <option value="French">French</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Poster URL</label>
                            <input type="url" class="form-input" id="moviePoster" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Backdrop URL</label>
                            <input type="url" class="form-input" id="movieBackdrop" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Storyline</label>
                            <textarea class="form-input form-textarea" id="movieStoryline" placeholder="Enter storyline..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Movie Link *</label>
                            <input type="url" class="form-input" id="movieLink" placeholder="Enter video/streaming link">
                        </div>
                        <div class="preview-row">
                            <img src="https://via.placeholder.com/90x135?text=Poster" class="preview-poster" id="moviePosterPreview">
                            <img src="https://via.placeholder.com/200x135?text=Backdrop" class="preview-backdrop" id="movieBackdropPreview">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-users"></i>
                        <span class="card-title">Cast</span>
                    </div>
                    <div class="card-body">
                        <div class="cast-grid" id="movieCastGrid">
                            <div class="empty-state" style="grid-column: span 4;">
                                <i class="fas fa-users"></i>
                                <p>Fetch from TMDB to load cast</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-success btn-block">
                    <i class="fas fa-save"></i> Save Movie
                </button>
            </form>
        </section>

        <!-- Edit Movie Section -->
        <section class="section" id="editMovieSection">
            <div class="page-header">
                <h1 class="page-title">
                    <i class="fas fa-edit"></i>
                    Edit Movies
                </h1>
            </div>

            <div class="filter-row" id="movieFilterRow">
                <button class="filter-btn active" onclick="filterMovies('all', this)">All</button>
            </div>

            <div class="data-list" id="moviesList">
                <div class="empty-state">
                    <i class="fas fa-film"></i>
                    <p>Loading movies...</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title" id="editModalTitle">Edit</span>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body" id="editModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-success" id="saveEditBtn" onclick="saveEdit()">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Confirm Delete</span>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle" style="color: var(--bright-red);"></i>
                    <p>Are you sure you want to delete?<br><small style="color: var(--gray);">This cannot be undone.</small></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
        <div class="loading-text" id="loadingText">Loading...</div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Refresh Button -->
    <button class="refresh-btn" onclick="refreshData()">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCbeS3rJKWLwM4b757Nc4pcuiUhghFEV4Y",
  authDomain: "movie-box-b4daf.firebaseapp.com",
  databaseURL: "https://movie-box-b4daf-default-rtdb.firebaseio.com",
  projectId: "movie-box-b4daf",
  storageBucket: "movie-box-b4daf.firebasestorage.app",
  messagingSenderId: "625334367654",
  appId: "1:625334367654:web:9828d6280aa50771474b67",
  measurementId: "G-Y2LTDYLLNK"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const TMDB_API_KEY = '2e211dfda888f7cc55ce433d743f9bc3';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/';

        // Global State
        let allCategories = [];
        let allWebseries = [];
        let allMovies = [];
        let currentWebseriesCast = [];
        let currentMovieCast = [];
        let sessionCount = 0;
        let selectedCategoryIcon = 'fas fa-folder';
        let editType = '';
        let editId = '';
        let deleteType = '';
        let deleteId = '';

        const iconOptions = [
            'fas fa-globe-americas', 'fas fa-globe-asia', 'fas fa-map-marker-alt',
            'fas fa-film', 'fas fa-tv', 'fas fa-video', 'fas fa-star', 'fas fa-heart',
            'fas fa-fire', 'fas fa-bolt', 'fas fa-crown', 'fas fa-gem',
            'fas fa-mask', 'fas fa-ghost', 'fas fa-dragon', 'fas fa-robot',
            'fas fa-rocket', 'fas fa-car', 'fas fa-skull', 'fas fa-magic',
            'fas fa-hat-wizard', 'fas fa-theater-masks', 'fas fa-music', 'fas fa-guitar'
        ];

        // Firebase Connection
        database.ref('.info/connected').on('value', (snap) => {
            const status = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                status.className = 'connection-status connected';
                status.innerHTML = '<i class="fas fa-check-circle"></i> Firebase Connected';
            } else {
                status.className = 'connection-status disconnected';
                status.innerHTML = '<i class="fas fa-times-circle"></i> Firebase Disconnected';
            }
        });

        // Sidebar Toggle
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        // Show Section
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            
            document.getElementById(sectionName + 'Section').classList.add('active');
            event.target.closest('.menu-item').classList.add('active');
            
            toggleSidebar();

            // Load data based on section
            if (sectionName === 'dashboard') loadDashboard();
            if (sectionName === 'categories') loadCategories();
            if (sectionName === 'addWebseries') loadCategorySelectors();
            if (sectionName === 'addMovie') loadCategorySelectors();
            if (sectionName === 'editWebseries') { loadCategorySelectors(); loadWebseries(); }
            if (sectionName === 'editMovie') { loadCategorySelectors(); loadMovies(); }
        }

        // Loading
        function showLoading(text = 'Loading...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        // Toast
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle';
            toast.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // Refresh Data
        async function refreshData() {
            showLoading('Refreshing...');
            await loadAllData();
            hideLoading();
            showToast('Data refreshed!', 'success');
        }

        // Load All Data
        async function loadAllData() {
            try {
                // Categories
                const catSnap = await database.ref('categories').once('value');
                allCategories = [];
                catSnap.forEach(c => allCategories.push({ id: c.key, ...c.val() }));

                // Web Series
                const webSnap = await database.ref('webseries').once('value');
                allWebseries = [];
                webSnap.forEach(c => allWebseries.push({ id: c.key, ...c.val() }));
                allWebseries.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

                // Movies
                const movSnap = await database.ref('movies').once('value');
                allMovies = [];
                movSnap.forEach(c => allMovies.push({ id: c.key, ...c.val() }));
                allMovies.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));

            } catch (error) {
                console.error('Load error:', error);
                showToast('Error loading data', 'error');
            }
        }

        // Icon Picker
        function loadIconPicker() {
            const picker = document.getElementById('iconPicker');
            if (!picker) return;
            picker.innerHTML = iconOptions.map(icon => `
                <div class="icon-option ${icon === selectedCategoryIcon ? 'selected' : ''}" onclick="selectIcon('${icon}', this)">
                    <i class="${icon}"></i>
                </div>
            `).join('');
        }

        function selectIcon(icon, element) {
            selectedCategoryIcon = icon;
            document.querySelectorAll('.icon-option').forEach(e => e.classList.remove('selected'));
            element.classList.add('selected');
        }

        // Create Category
        async function createCategory() {
            const nameInput = document.getElementById('newCategoryName');
            const name = nameInput.value.trim();
            if (!name) {
                showToast('Enter category name', 'error');
                return;
            }

            showLoading('Creating category...');
            try {
                await database.ref('categories').push({
                    name: name,
                    icon: selectedCategoryIcon,
                    createdAt: Date.now()
                });
                nameInput.value = '';
                showToast('Category created!', 'success');
                await loadAllData();
                loadCategories();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        // Load Categories
        async function loadCategories() {
            await loadAllData();
            loadIconPicker();

            const container = document.getElementById('categoriesList');
            if (!container) return;

            if (allCategories.length === 0) {
                container.innerHTML = '<div class="empty-state" style="grid-column: span 2;"><i class="fas fa-folder-open"></i><p>No categories yet. Create one above.</p></div>';
                return;
            }

            container.innerHTML = allCategories.map(cat => `
                <div class="category-card">
                    <button class="category-card-delete" onclick="event.stopPropagation(); deleteCategoryConfirm('${cat.id}')">
                        <i class="fas fa-times"></i>
                    </button>
                    <i class="${cat.icon || 'fas fa-folder'} category-icon"></i>
                    <div class="category-card-name">${cat.name}</div>
                </div>
            `).join('');
        }

        // Delete Category
        async function deleteCategoryConfirm(id) {
            if (!confirm('Delete this category?')) return;
            showLoading('Deleting...');
            try {
                await database.ref('categories/' + id).remove();
                showToast('Category deleted!', 'success');
                await loadAllData();
                loadCategories();
                loadCategorySelectors();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        // Load Category Selectors
        async function loadCategorySelectors() {
            await loadAllData();

            const webGrid = document.getElementById('webseriesCategoryGrid');
            const movGrid = document.getElementById('movieCategoryGrid');

            const emptyHtml = '<div class="empty-state" style="grid-column: span 2;"><i class="fas fa-folder-open"></i><p>Create categories first</p></div>';

            if (allCategories.length === 0) {
                if (webGrid) webGrid.innerHTML = emptyHtml;
                if (movGrid) movGrid.innerHTML = emptyHtml;
                updateFilterButtons();
                return;
            }

            const html = allCategories.map(cat => `
                <div class="category-card" data-id="${cat.id}" onclick="selectCategoryCard(this, '${cat.id}')">
                    <i class="${cat.icon || 'fas fa-folder'} category-icon"></i>
                    <div class="category-card-name">${cat.name}</div>
                </div>
            `).join('');

            if (webGrid) webGrid.innerHTML = html;
            if (movGrid) movGrid.innerHTML = html;
            updateFilterButtons();
        }

        // Select Category Card
        function selectCategoryCard(element, categoryId) {
            const container = element.closest('.category-grid');
            container.querySelectorAll('.category-card').forEach(c => c.classList.remove('selected'));
            element.classList.add('selected');

            const hiddenInput = container.parentElement.querySelector('input[type="hidden"]');
            if (hiddenInput) hiddenInput.value = categoryId;
        }

        // Update Filter Buttons
        function updateFilterButtons() {
            const webFilter = document.getElementById('webseriesFilterRow');
            const movFilter = document.getElementById('movieFilterRow');

            const catButtons = allCategories.map(c => `<button class="filter-btn" onclick="filterWebseries('${c.id}', this)">${c.name}</button>`).join('');
            const movCatButtons = allCategories.map(c => `<button class="filter-btn" onclick="filterMovies('${c.id}', this)">${c.name}</button>`).join('');

            if (webFilter) webFilter.innerHTML = `<button class="filter-btn active" onclick="filterWebseries('all', this)">All</button>${catButtons}`;
            if (movFilter) movFilter.innerHTML = `<button class="filter-btn active" onclick="filterMovies('all', this)">All</button>${movCatButtons}`;
        }

        // ========== TMDB FETCH ==========

        // Fetch Web Series from TMDB
        async function fetchWebseriesFromTMDB() {
            const id = document.getElementById('tmdbWebseriesId').value.trim();
            if (!id) {
                showToast('Enter TMDB TV Series ID', 'error');
                return;
            }

            showLoading('Fetching from TMDB...');
            try {
                const res = await fetch(`https://api.themoviedb.org/3/tv/${id}?api_key=${TMDB_API_KEY}`);
                const data = await res.json();

                if (data.success === false) throw new Error(data.status_message || 'Not found');

                document.getElementById('webseriesTitle').value = data.name || '';
                document.getElementById('webseriesYear').value = data.first_air_date ? data.first_air_date.split('-')[0] : '';
                document.getElementById('webseriesRating').value = data.vote_average ? data.vote_average.toFixed(1) : '';
                document.getElementById('webseriesPoster').value = data.poster_path ? TMDB_IMAGE_BASE + 'w500' + data.poster_path : '';
                document.getElementById('webseriesBackdrop').value = data.backdrop_path ? TMDB_IMAGE_BASE + 'original' + data.backdrop_path : '';
                document.getElementById('webseriesStoryline').value = data.overview || '';

                updatePreview('webseries');

                // Fetch cast
                const creditsRes = await fetch(`https://api.themoviedb.org/3/tv/${id}/credits?api_key=${TMDB_API_KEY}`);
                const credits = await creditsRes.json();
                currentWebseriesCast = (credits.cast || []).slice(0, 10).map(p => ({
                    name: p.name,
                    photo: p.profile_path ? TMDB_IMAGE_BASE + 'w185' + p.profile_path : ''
                }));
                displayCast('webseries', currentWebseriesCast);

                // Fetch seasons and create sessions
                document.getElementById('sessionsContainer').innerHTML = '';
                sessionCount = 0;

                if (data.seasons && data.seasons.length > 0) {
                    for (const season of data.seasons) {
                        if (season.season_number > 0) {
                            addSession(season.name || 'Season ' + season.season_number, season.episode_count || 1);
                        }
                    }
                }

                showToast('Data fetched successfully!', 'success');
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        // Fetch Movie from TMDB
        async function fetchMovieFromTMDB() {
            const id = document.getElementById('tmdbMovieId').value.trim();
            if (!id) {
                showToast('Enter TMDB Movie ID', 'error');
                return;
            }

            showLoading('Fetching from TMDB...');
            try {
                const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${TMDB_API_KEY}`);
                const data = await res.json();

                if (data.success === false) throw new Error(data.status_message || 'Not found');

                document.getElementById('movieTitle').value = data.title || '';
                document.getElementById('movieYear').value = data.release_date ? data.release_date.split('-')[0] : '';
                document.getElementById('movieRating').value = data.vote_average ? data.vote_average.toFixed(1) : '';
                document.getElementById('moviePoster').value = data.poster_path ? TMDB_IMAGE_BASE + 'w500' + data.poster_path : '';
                document.getElementById('movieBackdrop').value = data.backdrop_path ? TMDB_IMAGE_BASE + 'original' + data.backdrop_path : '';
                document.getElementById('movieStoryline').value = data.overview || '';

                updatePreview('movie');

                // Fetch cast
                const creditsRes = await fetch(`https://api.themoviedb.org/3/movie/${id}/credits?api_key=${TMDB_API_KEY}`);
                const credits = await creditsRes.json();
                currentMovieCast = (credits.cast || []).slice(0, 10).map(p => ({
                    name: p.name,
                    photo: p.profile_path ? TMDB_IMAGE_BASE + 'w185' + p.profile_path : ''
                }));
                displayCast('movie', currentMovieCast);

                showToast('Data fetched successfully!', 'success');
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        // Display Cast
        function displayCast(type, cast) {
            const grid = document.getElementById(type + 'CastGrid');
            if (!grid) return;

            if (!cast || cast.length === 0) {
                grid.innerHTML = '<div class="empty-state" style="grid-column: span 4;"><i class="fas fa-users"></i><p>No cast data</p></div>';
                return;
            }

            grid.innerHTML = cast.map(p => `
                <div class="cast-item">
                    <img src="${p.photo || 'https://via.placeholder.com/50?text=N/A'}" class="cast-photo" onerror="this.src='https://via.placeholder.com/50?text=N/A'">
                    <div class="cast-name">${p.name || 'Unknown'}</div>
                </div>
            `).join('');
        }

        // Update Preview
        function updatePreview(type) {
            const posterPreview = document.getElementById(type + 'PosterPreview');
            const backdropPreview = document.getElementById(type + 'BackdropPreview');
            const posterInput = document.getElementById(type + 'Poster');
            const backdropInput = document.getElementById(type + 'Backdrop');

            if (posterPreview && posterInput) {
                posterPreview.src = posterInput.value || 'https://via.placeholder.com/90x135?text=Poster';
            }
            if (backdropPreview && backdropInput) {
                backdropPreview.src = backdropInput.value || 'https://via.placeholder.com/200x135?text=Backdrop';
            }
        }

        // Preview Listeners
        document.addEventListener('DOMContentLoaded', () => {
            ['webseriesPoster', 'webseriesBackdrop'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', () => updatePreview('webseries'));
            });
            ['moviePoster', 'movieBackdrop'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', () => updatePreview('movie'));
            });
        });

        // ========== SESSIONS & EPISODES ==========

        function addSession(name = '', episodeCount = 1) {
            sessionCount++;
            const container = document.getElementById('sessionsContainer');
            if (!container) return;

            const sessionHtml = `
                <div class="session-card" id="session${sessionCount}">
                    <div class="session-header" onclick="toggleSession(${sessionCount})">
                        <input type="text" class="session-title-input" value="${name || 'Season ' + sessionCount}" id="sessionName${sessionCount}" onclick="event.stopPropagation()">
                        <div class="session-header-actions">
                            <button type="button" class="btn btn-sm btn-danger" onclick="event.stopPropagation(); removeSession(${sessionCount})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="session-body" id="sessionBody${sessionCount}">
                        <div id="episodesContainer${sessionCount}"></div>
                        <button type="button" class="btn btn-secondary btn-block" style="margin-top: 10px;" onclick="addEpisode(${sessionCount})">
                            <i class="fas fa-plus"></i> Add Episode
                        </button>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', sessionHtml);

            // Add episodes
            for (let i = 1; i <= episodeCount; i++) {
                addEpisode(sessionCount);
            }
        }

        function toggleSession(num) {
            const body = document.getElementById('sessionBody' + num);
            if (body) body.classList.toggle('show');
        }

        function removeSession(num) {
            const session = document.getElementById('session' + num);
            if (session) session.remove();
        }

        function addEpisode(sessionNum) {
            const container = document.getElementById('episodesContainer' + sessionNum);
            if (!container) return;

            const epNum = container.children.length + 1;
            const episodeHtml = `
                <div class="episode-row" id="ep${sessionNum}_${epNum}">
                    <span class="episode-number">E${epNum}</span>
                    <input type="url" class="form-input" placeholder="Episode ${epNum} Link" id="epLink${sessionNum}_${epNum}">
                    <button type="button" class="btn btn-sm btn-danger" onclick="removeEpisode(${sessionNum}, ${epNum})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', episodeHtml);
        }

        function removeEpisode(sessionNum, epNum) {
            const ep = document.getElementById(`ep${sessionNum}_${epNum}`);
            if (ep) ep.remove();
        }

        // Collect Sessions Data
        function collectSessionsData() {
            const sessions = [];
            const sessionCards = document.querySelectorAll('[id^="session"]:not([id*="Body"]):not([id*="Name"]):not([id*="Container"])');

            sessionCards.forEach(card => {
                const num = card.id.replace('session', '');
                const nameInput = document.getElementById('sessionName' + num);
                const episodesContainer = document.getElementById('episodesContainer' + num);

                if (!nameInput || !episodesContainer) return;

                const episodes = [];
                episodesContainer.querySelectorAll('.episode-row').forEach((row, index) => {
                    const linkInput = row.querySelector('input[type="url"]');
                    episodes.push({
                        number: index + 1,
                        link: linkInput ? linkInput.value : ''
                    });
                });

                if (episodes.length > 0) {
                    sessions.push({
                        name: nameInput.value || 'Season',
                        episodes: episodes
                    });
                }
            });

            return sessions;
        }

        // ========== SAVE WEB SERIES ==========

        async function saveWebseries(event) {
            event.preventDefault();

            const category = document.getElementById('webseriesCategory').value;
            if (!category) {
                showToast('Please select a category', 'error');
                return;
            }

            const title = document.getElementById('webseriesTitle').value.trim();
            if (!title) {
                showToast('Please enter a title', 'error');
                return;
            }

            showLoading('Saving web series...');

            const data = {
                title: title,
                year: document.getElementById('webseriesYear').value.trim(),
                rating: document.getElementById('webseriesRating').value.trim(),
                language: document.getElementById('webseriesLanguage').value,
                poster: document.getElementById('webseriesPoster').value.trim(),
                backdrop: document.getElementById('webseriesBackdrop').value.trim(),
                storyline: document.getElementById('webseriesStoryline').value.trim(),
                category: category,
                cast: currentWebseriesCast,
                sessions: collectSessionsData(),
                type: 'webseries',
                createdAt: Date.now()
            };

            try {
                await database.ref('webseries').push(data);
                showToast('Web series saved successfully!', 'success');

                // Reset form
                document.getElementById('webseriesForm').reset();
                document.getElementById('sessionsContainer').innerHTML = '';
                sessionCount = 0;
                currentWebseriesCast = [];
                displayCast('webseries', []);
                document.querySelectorAll('#webseriesCategoryGrid .category-card').forEach(c => c.classList.remove('selected'));
                document.getElementById('webseriesCategory').value = '';
                updatePreview('webseries');

                await loadAllData();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        // ========== SAVE MOVIE ==========

        async function saveMovie(event) {
            event.preventDefault();

            const category = document.getElementById('movieCategory').value;
            if (!category) {
                showToast('Please select a category', 'error');
                return;
            }

            const title = document.getElementById('movieTitle').value.trim();
            if (!title) {
                showToast('Please enter a title', 'error');
                return;
            }

            showLoading('Saving movie...');

            const data = {
                title: title,
                year: document.getElementById('movieYear').value.trim(),
                rating: document.getElementById('movieRating').value.trim(),
                language: document.getElementById('movieLanguage').value,
                poster: document.getElementById('moviePoster').value.trim(),
                backdrop: document.getElementById('movieBackdrop').value.trim(),
                storyline: document.getElementById('movieStoryline').value.trim(),
                link: document.getElementById('movieLink').value.trim(),
                category: category,
                cast: currentMovieCast,
                type: 'movie',
                createdAt: Date.now()
            };

            try {
                await database.ref('movies').push(data);
                showToast('Movie saved successfully!', 'success');

                // Reset form
                document.getElementById('movieForm').reset();
                currentMovieCast = [];
                displayCast('movie', []);
                document.querySelectorAll('#movieCategoryGrid .category-card').forEach(c => c.classList.remove('selected'));
                document.getElementById('movieCategory').value = '';
                updatePreview('movie');

                await loadAllData();
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        // ========== LOAD WEB SERIES ==========

        async function loadWebseries() {
            await loadAllData();
            displayWebseriesList(allWebseries);
        }

        function displayWebseriesList(items) {
            const container = document.getElementById('webseriesList');
            if (!container) return;

            if (items.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-tv"></i><p>No web series found</p></div>';
                return;
            }

            container.innerHTML = items.map(item => {
                const cat = allCategories.find(c => c.id === item.category);
                const sessionCount = item.sessions ? item.sessions.length : 0;
                return `
                    <div class="data-item">
                        <img src="${item.poster || 'https://via.placeholder.com/60x90?text=No+Poster'}" class="data-poster" onerror="this.src='https://via.placeholder.com/60x90?text=No+Poster'">
                        <div class="data-info">
                            <div class="data-title">${item.title || 'Untitled'}</div>
                            <div class="data-meta">${item.year || 'N/A'}  ${item.rating || 'N/A'}   ${sessionCount} Seasons</div>
                            <div class="data-tags">
                                <span class="data-tag">${cat ? cat.name : 'Uncategorized'}</span>
                                <span class="data-tag secondary">${item.language || 'N/A'}</span>
                            </div>
                            <div class="data-actions">
                                <button class="btn btn-sm btn-warning" onclick="editWebseries('${item.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteItem('webseries', '${item.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterWebseries(filter, btn) {
            document.querySelectorAll('#webseriesFilterRow .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (filter === 'all') {
                displayWebseriesList(allWebseries);
            } else {
                displayWebseriesList(allWebseries.filter(w => w.category === filter));
            }
        }

        // ========== LOAD MOVIES ==========

        async function loadMovies() {
            await loadAllData();
            displayMoviesList(allMovies);
        }

        function displayMoviesList(items) {
            const container = document.getElementById('moviesList');
            if (!container) return;

            if (items.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-film"></i><p>No movies found</p></div>';
                return;
            }

            container.innerHTML = items.map(item => {
                const cat = allCategories.find(c => c.id === item.category);
                return `
                    <div class="data-item">
                        <img src="${item.poster || 'https://via.placeholder.com/60x90?text=No+Poster'}" class="data-poster" onerror="this.src='https://via.placeholder.com/60x90?text=No+Poster'">
                        <div class="data-info">
                            <div class="data-title">${item.title || 'Untitled'}</div>
                            <div class="data-meta">${item.year || 'N/A'}  ${item.rating || 'N/A'} </div>
                            <div class="data-tags">
                                <span class="data-tag">${cat ? cat.name : 'Uncategorized'}</span>
                                <span class="data-tag secondary">${item.language || 'N/A'}</span>
                                ${item.link ? '<span class="data-tag" style="background: var(--green);">Has Link</span>' : '<span class="data-tag secondary">No Link</span>'}
                            </div>
                            <div class="data-actions">
                                <button class="btn btn-sm btn-warning" onclick="editMovie('${item.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteItem('movies', '${item.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterMovies(filter, btn) {
            document.querySelectorAll('#movieFilterRow .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (filter === 'all') {
                displayMoviesList(allMovies);
            } else {
                displayMoviesList(allMovies.filter(m => m.category === filter));
            }
        }

        // ========== EDIT WEB SERIES ==========

        function editWebseries(id) {
            const item = allWebseries.find(w => w.id === id);
            if (!item) {
                showToast('Web series not found', 'error');
                return;
            }

            editType = 'webseries';
            editId = id;

            const catOptions = allCategories.map(c => `<option value="${c.id}" ${item.category === c.id ? 'selected' : ''}>${c.name}</option>`).join('');
            const langOptions = ['English','Hindi','Tamil','Telugu','Malayalam','Kannada','Korean','Japanese','Spanish','French']
                .map(l => `<option value="${l}" ${item.language === l ? 'selected' : ''}>${l}</option>`).join('');

            // Build sessions HTML for editing
            let sessionsHtml = '';
            if (item.sessions && item.sessions.length > 0) {
                sessionsHtml = item.sessions.map((session, sIndex) => {
                    const episodesHtml = (session.episodes || []).map((ep, eIndex) => `
                        <div class="form-group">
                            <label class="form-label">Episode ${ep.number || eIndex + 1} Link</label>
                            <input type="url" class="form-input" id="editEp${sIndex}_${eIndex}" value="${ep.link || ''}" placeholder="Enter episode link">
                        </div>
                    `).join('');
                    return `
                        <div style="background: var(--dark-black); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <div class="form-group">
                                <label class="form-label">${session.name || 'Season ' + (sIndex + 1)}</label>
                            </div>
                            ${episodesHtml}
                        </div>
                    `;
                }).join('');
            }

            document.getElementById('editModalTitle').textContent = 'Edit Web Series';
            document.getElementById('editModalBody').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="editTitle" value="${item.title || ''}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="editYear" value="${item.year || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rating</label>
                        <input type="text" class="form-input" id="editRating" value="${item.rating || ''}">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-input form-select" id="editCategory">${catOptions}</select>
                </div>
                <div class="form-group">
                    <label class="form-label">Language</label>
                    <select class="form-input form-select" id="editLanguage">${langOptions}</select>
                </div>
                <div class="form-group">
                    <label class="form-label">Poster URL</label>
                    <input type="url" class="form-input" id="editPoster" value="${item.poster || ''}">
                </div>
                <div class="form-group">
                    <label class="form-label">Backdrop URL</label>
                    <input type="url" class="form-input" id="editBackdrop" value="${item.backdrop || ''}">
                </div>
                <div class="form-group">
                    <label class="form-label">Storyline</label>
                    <textarea class="form-input form-textarea" id="editStoryline">${item.storyline || ''}</textarea>
                </div>
                ${sessionsHtml ? `<div class="form-group"><label class="form-label" style="color: var(--bright-red);">Episode Links</label>${sessionsHtml}</div>` : ''}
            `;

            document.getElementById('editModal').classList.add('show');
        }

        // ========== EDIT MOVIE ==========

        function editMovie(id) {
            const item = allMovies.find(m => m.id === id);
            if (!item) {
                showToast('Movie not found', 'error');
                return;
            }

            editType = 'movies';
            editId = id;

            const catOptions = allCategories.map(c => `<option value="${c.id}" ${item.category === c.id ? 'selected' : ''}>${c.name}</option>`).join('');
            const langOptions = ['English','Hindi','Tamil','Telugu','Malayalam','Kannada','Korean','Japanese','Spanish','French']
                .map(l => `<option value="${l}" ${item.language === l ? 'selected' : ''}>${l}</option>`).join('');

            document.getElementById('editModalTitle').textContent = 'Edit Movie';
            document.getElementById('editModalBody').innerHTML = `
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="editTitle" value="${item.title || ''}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="editYear" value="${item.year || ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rating</label>
                        <input type="text" class="form-input" id="editRating" value="${item.rating || ''}">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-input form-select" id="editCategory">${catOptions}</select>
                </div>
                <div class="form-group">
                    <label class="form-label">Language</label>
                    <select class="form-input form-select" id="editLanguage">${langOptions}</select>
                </div>
                <div class="form-group">
                    <label class="form-label">Poster URL</label>
                    <input type="url" class="form-input" id="editPoster" value="${item.poster || ''}">
                </div>
                <div class="form-group">
                    <label class="form-label">Backdrop URL</label>
                    <input type="url" class="form-input" id="editBackdrop" value="${item.backdrop || ''}">
                </div>
                <div class="form-group">
                    <label class="form-label">Storyline</label>
                    <textarea class="form-input form-textarea" id="editStoryline">${item.storyline || ''}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: var(--bright-red);">Movie Link</label>
                    <input type="url" class="form-input" id="editLink" value="${item.link || ''}" placeholder="Enter video link">
                </div>
            `;

            document.getElementById('editModal').classList.add('show');
        }

        // ========== SAVE EDIT ==========

        async function saveEdit() {
            showLoading('Saving changes...');

            const updateData = {
                title: document.getElementById('editTitle').value.trim(),
                year: document.getElementById('editYear').value.trim(),
                rating: document.getElementById('editRating').value.trim(),
                category: document.getElementById('editCategory').value,
                language: document.getElementById('editLanguage').value,
                poster: document.getElementById('editPoster').value.trim(),
                backdrop: document.getElementById('editBackdrop').value.trim(),
                storyline: document.getElementById('editStoryline').value.trim(),
                updatedAt: Date.now()
            };

            // For movies, include link
            if (editType === 'movies') {
                updateData.link = document.getElementById('editLink').value.trim();
            }

            // For web series, collect episode links
            if (editType === 'webseries') {
                const item = allWebseries.find(w => w.id === editId);
                if (item && item.sessions) {
                    const updatedSessions = item.sessions.map((session, sIndex) => {
                        const updatedEpisodes = (session.episodes || []).map((ep, eIndex) => {
                            const linkInput = document.getElementById(`editEp${sIndex}_${eIndex}`);
                            return {
                                number: ep.number || eIndex + 1,
                                link: linkInput ? linkInput.value.trim() : ep.link
                            };
                        });
                        return {
                            name: session.name,
                            episodes: updatedEpisodes
                        };
                    });
                    updateData.sessions = updatedSessions;
                }
            }

            try {
                await database.ref(`${editType}/${editId}`).update(updateData);
                showToast('Updated successfully!', 'success');
                closeEditModal();
                await loadAllData();

                if (editType === 'webseries') {
                    displayWebseriesList(allWebseries);
                } else {
                    displayMoviesList(allMovies);
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editType = '';
            editId = '';
        }

        // ========== DELETE ==========

        function deleteItem(type, id) {
            deleteType = type;
            deleteId = id;
            document.getElementById('deleteModal').classList.add('show');
        }

        async function confirmDelete() {
            showLoading('Deleting...');
            try {
                await database.ref(`${deleteType}/${deleteId}`).remove();
                showToast('Deleted successfully!', 'success');
                closeDeleteModal();
                await loadAllData();

                if (deleteType === 'webseries') {
                    displayWebseriesList(allWebseries);
                } else {
                    displayMoviesList(allMovies);
                }
            } catch (error) {
                showToast('Error: ' + error.message, 'error');
            }
            hideLoading();
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('show');
            deleteType = '';
            deleteId = '';
        }

        // ========== DASHBOARD ==========

        async function loadDashboard() {
            await loadAllData();

            document.getElementById('statWebseries').textContent = allWebseries.length;
            document.getElementById('statMovies').textContent = allMovies.length;
            document.getElementById('statCategories').textContent = allCategories.length;
            document.getElementById('statTotal').textContent = allWebseries.length + allMovies.length;

            // Recent activity
            const allContent = [...allWebseries, ...allMovies];
            allContent.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            const recent = allContent.slice(0, 5);

            const container = document.getElementById('recentActivity');
            if (recent.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>No recent activity</p></div>';
            } else {
                container.innerHTML = '<div class="recent-list">' + recent.map(item => `
                    <div class="recent-item">
                        <img src="${item.poster || 'https://via.placeholder.com/45x68?text=N/A'}" onerror="this.src='https://via.placeholder.com/45x68?text=N/A'">
                        <div class="recent-item-info">
                            <div class="recent-item-title">${item.title || 'Untitled'}</div>
                            <div class="recent-item-meta">${item.type === 'webseries' ? 'Web Series' : 'Movie'}  ${new Date(item.createdAt).toLocaleDateString()}</div>
                        </div>
                    </div>
                `).join('') + '</div>';
            }
        }

        // ========== INIT ==========

        document.addEventListener('DOMContentLoaded', async () => {
            await loadAllData();
            loadDashboard();
        });
    </script>
</body>
</html>